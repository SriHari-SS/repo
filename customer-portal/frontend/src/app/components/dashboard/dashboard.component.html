<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="welcome-section">
        <h1>Business Dashboard</h1>
        <p class="welcome-message">Welcome back, {{ customer()?.name || 'Customer' }}</p>
        <p class="customer-id">Customer ID: {{ customer()?.customerId }}</p>
      </div>
      <div class="header-actions">
        <button class="financial-btn" (click)="goToFinancialSheet()">
          Financial Sheet
        </button>
        <button class="profile-btn" (click)="goToProfile()">
          My Profile
        </button>
        <button class="logout-btn" (click)="logout()">
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading dashboard...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="error-container">
    <div class="error-message">
      <p>{{ error() }}</p>
      <button class="retry-btn" (click)="loadDashboardData()">Try Again</button>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading() && !error() && dashboardData()" class="dashboard-content">
    
    <!-- Business Metrics Overview -->
    <div class="metrics-overview">
      <div class="metrics-grid">
        <div class="metric-card inquiries" (click)="setActiveTab('inquiries')">
          <div class="metric-content">
            <h3>{{ dashboardData()?.totalInquiries || 0 }}</h3>
            <p>Total Inquiries</p>
            <span class="metric-trend">+{{ dashboardData()?.inquiryConversionRate || 0 }}% conversion</span>
          </div>
        </div>

        <div class="metric-card orders" (click)="setActiveTab('orders')">
          <div class="metric-content">
            <h3>{{ dashboardData()?.totalSalesOrders || 0 }}</h3>
            <p>Sales Orders</p>
            <span class="metric-value">{{ formatCurrency(dashboardData()?.averageOrderValue || 0) }} avg</span>
          </div>
        </div>

        <div class="metric-card deliveries" (click)="setActiveTab('deliveries')">
          <div class="metric-content">
            <h3>{{ dashboardData()?.totalDeliveries || 0 }}</h3>
            <p>Deliveries</p>
            <span class="metric-trend">{{ getPercentage(dashboardData()?.deliveryPerformance || 0) }} on-time</span>
          </div>
        </div>

        <div class="metric-card outstanding" (click)="goToFinancialSheet()">
          <div class="metric-content">
            <h3>{{ formatCurrency(dashboardData()?.outstandingAmount || 0) }}</h3>
            <p>Outstanding Amount</p>
            <span class="metric-status">Pending payment</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      
      <!-- Overview Tab -->
      <div *ngIf="activeTab() === 'overview'" class="overview-content">
        
        <!-- Business Cards Section -->
        <div class="business-cards-grid">
          
          <!-- Inquiries Card -->
          <div class="business-card inquiries-card" (click)="setActiveTab('inquiries')">
            <div class="card-header">
              <div class="card-title">
                <h3>Recent Inquiries</h3>
              </div>
            </div>
            <div class="card-content">
              <!-- Debug info -->
              <div style="color: white; font-size: 12px; margin: 10px 0;">
                Debug: {{ (dashboardData()?.recentInquiries || []).length }} inquiries found
              </div>
              <div class="recent-items">
                <div 
                  *ngFor="let inquiry of dashboardData()?.recentInquiries || []; trackBy: trackByInquiry" 
                  class="item-card inquiry-item"
                >
                  <div class="item-header">
                    <span class="item-number">{{ inquiry.inquiryNumber }}</span>
                    <span class="item-status" [class]="getStatusClass(inquiry.status)">{{ inquiry.status }}</span>
                  </div>
                  <div class="item-details">
                    <p class="item-description">{{ inquiry.description }}</p>
                    <div class="item-meta">
                      <span class="item-date">{{ formatDate(inquiry.inquiryDate) }}</span>
                      <span class="item-priority" [class]="getPriorityClass(inquiry.priority)">{{ inquiry.priority }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Empty State for Recent Inquiries -->
                <div *ngIf="!dashboardData()?.recentInquiries || dashboardData()?.recentInquiries.length === 0" class="empty-state">
                  <div class="empty-icon">üìã</div>
                  <h4>No Recent Inquiries</h4>
                  <p>You haven't made any inquiries recently. Start by submitting a new product inquiry.</p>
                  <button class="create-btn" (click)="setActiveTab('inquiries')">View All Inquiries</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Sales Orders Card -->
          <div class="business-card orders-card" (click)="setActiveTab('orders')">
            <div class="card-header">
              <div class="card-title">
                <h3>Recent Sales Orders</h3>
              </div>
            </div>
            <div class="card-content">
              <!-- Debug info -->
              <div style="color: white; font-size: 12px; margin: 10px 0;">
                Debug: {{ (dashboardData()?.recentSalesOrders || []).length }} orders found
              </div>
              <div class="recent-items">
                <div 
                  *ngFor="let order of dashboardData()?.recentSalesOrders || []; trackBy: trackBySalesOrder" 
                  class="item-card order-item"
                >
                  <div class="item-header">
                    <span class="item-number">{{ order.orderNumber }}</span>
                    <span class="item-status" [class]="getStatusClass(order.status)">{{ order.status }}</span>
                  </div>
                  <div class="item-details">
                    <div class="item-amount">{{ formatCurrency(order.orderValue) }}</div>
                    <div class="item-meta">
                      <span class="item-date">{{ formatDate(order.orderDate) }}</span>
                      <span class="delivery-date">Due: {{ formatDate(order.requestedDeliveryDate) }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Empty State for Recent Sales Orders -->
                <div *ngIf="!dashboardData()?.recentSalesOrders || dashboardData()?.recentSalesOrders.length === 0" class="empty-state">
                  <div class="empty-icon">üõí</div>
                  <h4>No Recent Orders</h4>
                  <p>No sales orders found. Place your first order to see it here.</p>
                  <button class="create-btn" (click)="setActiveTab('orders')">View All Orders</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Deliveries Card -->
          <div class="business-card deliveries-card" (click)="setActiveTab('deliveries')">
            <div class="card-header">
              <div class="card-title">
                <h3>Recent Deliveries</h3>
              </div>
            </div>
            <div class="card-content">
              <!-- Debug info -->
              <div style="color: white; font-size: 12px; margin: 10px 0;">
                Debug: {{ (dashboardData()?.recentDeliveries || []).length }} deliveries found
              </div>
              <div class="recent-items">
                <div 
                  *ngFor="let delivery of dashboardData()?.recentDeliveries || []; trackBy: trackByDelivery" 
                  class="item-card delivery-item"
                >
                  <div class="item-header">
                    <span class="item-number">{{ delivery.deliveryNumber }}</span>
                    <span class="item-status" [class]="getStatusClass(delivery.status)">{{ delivery.status }}</span>
                  </div>
                  <div class="item-details">
                    <p class="tracking-number" *ngIf="delivery.trackingNumber">
                      Tracking: {{ delivery.trackingNumber }}
                    </p>
                    <div class="item-meta">
                      <span class="item-date">{{ formatDate(delivery.deliveryDate) }}</span>
                      <span class="carrier" *ngIf="delivery.carrier">{{ delivery.carrier }}</span>
                    </div>
                  </div>
                </div>
                
                <!-- Empty State for Recent Deliveries -->
                <div *ngIf="!dashboardData()?.recentDeliveries || dashboardData()?.recentDeliveries.length === 0" class="empty-state">
                  <div class="empty-icon">üöö</div>
                  <h4>No Recent Deliveries</h4>
                  <p>No deliveries to track. Your shipments will appear here once dispatched.</p>
                  <button class="create-btn" (click)="setActiveTab('deliveries')">View All Deliveries</button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Inquiries Tab -->
      <div *ngIf="activeTab() === 'inquiries'" class="inquiries-content">
        <div class="content-header">
          <button class="back-btn" (click)="setActiveTab('overview')">‚Üê Back to Dashboard</button>
          <h2>Customer Inquiries</h2>
          <p class="content-description">
            Track your product and service inquiries, quotation requests, and their current status
          </p>
        </div>
        
        <div class="inquiries-list">
          <div 
            *ngFor="let inquiry of inquiries(); trackBy: trackByInquiry" 
            class="inquiry-card"
          >
            <div class="inquiry-header">
              <div class="inquiry-info">
                <h4>{{ inquiry.inquiryNumber }}</h4>
                <span class="inquiry-status" [class]="getStatusClass(inquiry.status)">{{ inquiry.status }}</span>
                <span class="inquiry-priority" [class]="getPriorityClass(inquiry.priority)">{{ inquiry.priority }}</span>
              </div>
              <div class="inquiry-dates">
                <span class="inquiry-date">{{ formatDate(inquiry.inquiryDate) }}</span>
                <span class="valid-until" *ngIf="inquiry.validUntil">Valid until: {{ formatDate(inquiry.validUntil) }}</span>
              </div>
            </div>
            
            <div class="inquiry-content">
              <p class="inquiry-description">{{ inquiry.description }}</p>
              
              <div class="inquiry-items">
                <div class="items-header">
                  <h5>Requested Items ({{ inquiry.items.length }})</h5>
                  <span class="total-value" *ngIf="inquiry.totalValue">
                    Est. Value: {{ formatCurrency(inquiry.totalValue) }}
                  </span>
                </div>
                
                <div class="items-list">
                  <div 
                    *ngFor="let item of inquiry.items; trackBy: trackByItem" 
                    class="inquiry-item"
                  >
                    <div class="item-details">
                      <span class="material-number">{{ item.materialNumber }}</span>
                      <span class="item-description">{{ item.description }}</span>
                    </div>
                    <div class="item-quantity">
                      <span class="quantity">{{ item.quantity }} {{ item.unit }}</span>
                      <span class="delivery-date" *ngIf="item.requestedDeliveryDate">
                        Needed: {{ formatDate(item.requestedDeliveryDate) }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="inquiry-footer" *ngIf="inquiry.salesRep">
                <span class="sales-rep">Sales Rep: {{ inquiry.salesRep }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Orders Tab -->
      <div *ngIf="activeTab() === 'orders'" class="orders-content">
        <div class="content-header">
          <button class="back-btn" (click)="setActiveTab('overview')">‚Üê Back to Dashboard</button>
          <h2>Sales Orders</h2>
          <p class="content-description">
            Monitor your confirmed orders, delivery schedules, and order fulfillment status
          </p>
        </div>
        
        <div class="orders-list">
          <div 
            *ngFor="let order of salesOrders(); trackBy: trackBySalesOrder" 
            class="order-card"
          >
            <div class="order-header">
              <div class="order-info">
                <h4>{{ order.orderNumber }}</h4>
                <span class="order-status" [class]="getStatusClass(order.status)">{{ order.status }}</span>
                <span class="order-value">{{ formatCurrency(order.orderValue) }} {{ order.currency }}</span>
              </div>
              <div class="order-dates">
                <span class="order-date">Ordered: {{ formatDate(order.orderDate) }}</span>
                <span class="delivery-date">Due: {{ formatDate(order.requestedDeliveryDate) }}</span>
              </div>
            </div>
            
            <div class="order-content">
              <div class="order-details">
                <div class="detail-row" *ngIf="order.customerPO">
                  <span class="label">Customer PO:</span>
                  <span class="value">{{ order.customerPO }}</span>
                </div>
                <div class="detail-row" *ngIf="order.salesRep">
                  <span class="label">Sales Rep:</span>
                  <span class="value">{{ order.salesRep }}</span>
                </div>
                <div class="detail-row" *ngIf="order.paymentTerms">
                  <span class="label">Payment Terms:</span>
                  <span class="value">{{ order.paymentTerms }}</span>
                </div>
              </div>
              
              <div class="order-items">
                <div class="items-header">
                  <h5>Order Items ({{ order.items.length }})</h5>
                </div>
                
                <div class="items-table">
                  <div 
                    *ngFor="let item of order.items; trackBy: trackByItem" 
                    class="order-item"
                  >
                    <div class="item-info">
                      <span class="line-item">#{{ item.lineItem }}</span>
                      <span class="material-number">{{ item.materialNumber }}</span>
                      <span class="item-description">{{ item.description }}</span>
                    </div>
                    <div class="item-quantities">
                      <div class="quantity-info">
                        <span class="ordered">Ordered: {{ item.orderedQuantity }} {{ item.unit }}</span>
                        <span class="delivered">Delivered: {{ item.deliveredQuantity }} {{ item.unit }}</span>
                      </div>
                      <div class="price-info">
                        <span class="unit-price">{{ formatCurrency(item.unitPrice) }}/{{ item.unit }}</span>
                        <span class="total-price">{{ formatCurrency(item.totalPrice) }}</span>
                      </div>
                    </div>
                    <div class="item-status">
                      <span class="delivery-date">{{ formatDate(item.deliveryDate) }}</span>
                      <span class="item-status-badge" [class]="getStatusClass(item.status)">{{ item.status }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Deliveries Tab -->
      <div *ngIf="activeTab() === 'deliveries'" class="deliveries-content">
        <div class="content-header">
          <button class="back-btn" (click)="setActiveTab('overview')">‚Üê Back to Dashboard</button>
          <h2>Deliveries</h2>
          <p class="content-description">
            Track your shipments, delivery status, and arrival schedules in real-time
          </p>
        </div>
        
        <div class="deliveries-list">
          <div 
            *ngFor="let delivery of deliveries(); trackBy: trackByDelivery" 
            class="delivery-card"
          >
            <div class="delivery-header">
              <div class="delivery-info">
                <h4>{{ delivery.deliveryNumber }}</h4>
                <span class="delivery-status" [class]="getStatusClass(delivery.status)">{{ delivery.status }}</span>
                <span class="related-order">Order: {{ delivery.relatedSalesOrder }}</span>
              </div>
              <div class="tracking-info" *ngIf="delivery.trackingNumber">
                <span class="tracking-label">Tracking:</span>
                <span class="tracking-number">{{ delivery.trackingNumber }}</span>
              </div>
            </div>
            
            <div class="delivery-content">
              <div class="delivery-timeline">
                <div class="timeline-item">
                  <span class="timeline-label">Delivery Date:</span>
                  <span class="timeline-value">{{ formatDate(delivery.deliveryDate) }}</span>
                </div>
                <div class="timeline-item" *ngIf="delivery.estimatedArrival">
                  <span class="timeline-label">Estimated Arrival:</span>
                  <span class="timeline-value">{{ formatDateTime(delivery.estimatedArrival) }}</span>
                </div>
                <div class="timeline-item" *ngIf="delivery.actualArrival">
                  <span class="timeline-label">Actual Arrival:</span>
                  <span class="timeline-value">{{ formatDateTime(delivery.actualArrival) }}</span>
                </div>
              </div>
              
              <div class="delivery-details">
                <div class="detail-section">
                  <h5>Shipping Information</h5>
                  <div class="detail-row" *ngIf="delivery.carrier">
                    <span class="label">Carrier:</span>
                    <span class="value">{{ delivery.carrier }}</span>
                  </div>
                  <div class="detail-row" *ngIf="delivery.weight">
                    <span class="label">Weight:</span>
                    <span class="value">{{ delivery.weight }} kg</span>
                  </div>
                  <div class="detail-row" *ngIf="delivery.volume">
                    <span class="label">Volume:</span>
                    <span class="value">{{ delivery.volume }} m¬≥</span>
                  </div>
                </div>
                
                <div class="delivery-address">
                  <h5>Delivery Address</h5>
                  <p>{{ delivery.deliveryAddress }}</p>
                </div>
              </div>
              
              <div class="delivery-items">
                <div class="items-header">
                  <h5>Delivered Items ({{ delivery.items.length }})</h5>
                </div>
                
                <div class="items-list">
                  <div 
                    *ngFor="let item of delivery.items; trackBy: trackByItem" 
                    class="delivery-item"
                  >
                    <div class="item-details">
                      <span class="material-number">{{ item.materialNumber }}</span>
                      <span class="item-description">{{ item.description }}</span>
                    </div>
                    <div class="item-quantity">
                      <span class="quantity">{{ item.deliveredQuantity }} {{ item.unit }}</span>
                    </div>
                    <div class="item-tracking" *ngIf="item.batchNumber || item.serialNumbers">
                      <span class="batch" *ngIf="item.batchNumber">Batch: {{ item.batchNumber }}</span>
                      <span class="serials" *ngIf="item.serialNumbers && item.serialNumbers.length > 0">
                        Serials: {{ item.serialNumbers.join(', ') }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
